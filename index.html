<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Tooling Kod Parser</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        :root {
            --bg: #020617;
            --card: #020617;
            --border: #1f2937;
            --accent: #38bdf8;
            --accent-soft: #0ea5e9;
            --text: #e5e7eb;
            --muted: #9ca3af;
        }
        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: radial-gradient(circle at top, #1e293b, #020617 60%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
        }

        .shell {
            flex: 1;
            max-width: 900px;
            margin: 0 auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        header {
            padding: 4px;
        }

        h1 {
            margin: 0;
            font-size: 18px;
        }

        .sub {
            font-size: 12px;
            color: var(--muted);
            margin-top: 2px;
        }

        .card {
            border-radius: 12px;
            border: 1px solid var(--border);
            background: rgba(15,23,42,0.96);
            backdrop-filter: blur(12px);
            padding: 10px;
        }

        textarea {
            width: 100%;
            min-height: 140px;
            resize: vertical;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: #020617;
            color: var(--text);
            padding: 8px;
            font-size: 13px;
            font-family: system-ui, -apple-system, BlinkMacSystemFont;
        }

        .hint {
            font-size: 11px;
            color: var(--muted);
            margin-top: 4px;
        }

        button {
            padding: 9px 12px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--accent);
            color: #020617;
            font-weight: 600;
        }
        .btn-primary:hover { background: var(--accent-soft); }

        .btn-ghost {
            background: transparent;
            color: var(--text);
            border: 1px solid var(--border);
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .badge {
            display: inline-flex;
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.6);
            font-size: 11px;
            color: #e5e7eb;
            background: rgba(15,23,42,0.7);
        }

        .codes-card {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .codes-header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
        }

        .codes-title {
            font-size: 13px;
            font-weight: 600;
        }

        .codes-sub {
            font-size: 11px;
            color: var(--muted);
        }

        .scroll-area {
            border-radius: 8px;
            border: 1px solid #1f2937;
            max-height: 45vh;
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th, td {
            padding: 5px 6px;
            border-bottom: 1px solid #1f2937;
        }

        th {
            text-align: left;
            position: sticky;
            top: 0;
            background: rgba(15,23,42,0.98);
            z-index: 5;
        }

        .code-cell {
            font-family: Consolas, monospace;
            font-size: 12px;
        }

        .raw-cell {
            font-size: 11px;
            color: #9ca3af;
        }

        @media (min-width: 820px) {
            .lower {
                display: grid;
                grid-template-columns: 1.4fr 1.8fr;
                gap: 10px;
                flex: 1;
            }
        }
    </style>
</head>
<body>
<div class="shell">
    <header>
        <h1>Tooling Kod Parser</h1>
        <div class="sub">
            1) iPhone ile etiketi foto Ã§ek â†’ 2) FotoÄŸrafta Live Text ile tÃ¼m yazÄ±yÄ± seÃ§ & kopyala â†’ 3) AÅŸaÄŸÄ±ya yapÄ±ÅŸtÄ±r â†’ 4) "KodlarÄ± Ã‡Ä±kar" de.  
            Sistem iÃ§inden <b>CM389T-25A</b>, <b>CM-S-389LR</b> gibi kodlarÄ± otomatik toplar.
        </div>
    </header>

    <div class="lower">
        <!-- YapÄ±ÅŸtÄ±rma alanÄ± -->
        <div class="card">
            <div style="margin-bottom:6px; font-size:13px; font-weight:600;">ğŸ“¥ Metni Buraya YapÄ±ÅŸtÄ±r</div>
            <textarea id="rawInput" placeholder="Kamera / FotoÄŸraf Ã¼zerinden Live Text ile kopyaladÄ±ÄŸÄ±n metni buraya yapÄ±ÅŸtÄ±r (uzun uzun olabilir, sorun deÄŸil)."></textarea>
            <div class="row" style="margin-top:6px;">
                <button id="btnParse" class="btn-primary">ğŸ” KodlarÄ± Ã‡Ä±kar</button>
                <button id="btnClearInput" class="btn-ghost">ğŸ§¹ Metni Temizle</button>
            </div>
            <div class="hint">
                Ä°pucu: AynÄ± fotoÄŸrafÄ± birden fazla kez bile kopyalasan, sistem aynÄ± kodu sadece <b>1 kez</b> listeye alÄ±r (tekrarÄ± engeller).
            </div>
        </div>

        <!-- Kodlar listesi -->
        <div class="card codes-card">
            <div class="codes-header">
                <div class="codes-title">ğŸ“‹ Bulunan Kodlar</div>
                <div class="codes-sub">
                    <span class="badge" id="badgeCount">0 kod</span>
                </div>
            </div>
            <div class="row" style="margin-bottom:4px;">
                <button id="btnExport" class="btn-ghost">ğŸ’¾ CSV Ä°ndir</button>
                <button id="btnClearCodes" class="btn-ghost">ğŸ—‘ Listeyi Temizle</button>
            </div>
            <div class="scroll-area">
                <table>
                    <thead>
                    <tr>
                        <th style="width:32%;">Kod</th>
                        <th style="width:20%;">Kaynak</th>
                        <th>Ham SatÄ±r</th>
                    </tr>
                    </thead>
                    <tbody id="codesBody">
                    <tr>
                        <td colspan="3" style="font-size:11px; color:#6b7280;">
                            HenÃ¼z kod yok. Metni yapÄ±ÅŸtÄ±rÄ±p "KodlarÄ± Ã‡Ä±kar" butonuna bas.
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<script>
    const rawInput = document.getElementById('rawInput');
    const btnParse = document.getElementById('btnParse');
    const btnClearInput = document.getElementById('btnClearInput');
    const btnExport = document.getElementById('btnExport');
    const btnClearCodes = document.getElementById('btnClearCodes');
    const badgeCount = document.getElementById('badgeCount');
    const codesBody = document.getElementById('codesBody');

    // { code, line }
    let codes = [];

    btnParse.addEventListener('click', () => {
        const text = rawInput.value || '';
        if (!text.trim()) {
            alert('Ã–nce Live Text ile kopyaladÄ±ÄŸÄ±n metni yapÄ±ÅŸtÄ±r kanka ğŸ™‚');
            return;
        }
        parseText(text);
        renderCodes();
    });

    btnClearInput.addEventListener('click', () => {
        rawInput.value = '';
    });

    btnClearCodes.addEventListener('click', () => {
        codes = [];
        renderCodes();
    });

    function parseText(text) {
        const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length > 0);

        lines.forEach(line => {
            // CM389T-25A, CM 389T â€“ 25AS, CM-S-389LR, vb.
            const regex = /(CM[\s\-]?[0-9]{2,}[A-Z0-9\s\-]{0,12})/gi;
            const matches = line.match(regex);
            if (!matches) return;

            matches.forEach(m => {
                let code = m.toUpperCase();

                // Uzun tireleri dÃ¼zle
                code = code.replace(/[â€“â€”]/g, '-');
                // BoÅŸluklarÄ± kaldÄ±r
                code = code.replace(/\s+/g, '');
                // BaÅŸ/son noktalama temizliÄŸi
                code = code.replace(/^[\.\,:;]+/, '').replace(/[\.\,:;]+$/, '');

                if (code.length < 6) return;
                if (!code.startsWith('CM')) return;

                // Daha Ã¶nce eklenmiÅŸse atla
                if (codes.some(c => c.code === code)) return;

                codes.push({
                    code,
                    line
                });
            });
        });
    }

    function renderCodes() {
        codesBody.innerHTML = '';

        if (!codes.length) {
            const tr = document.createElement('tr');
            const td = document.createElement('td');
            td.colSpan = 3;
            td.style.fontSize = '11px';
            td.style.color = '#6b7280';
            td.textContent = 'HenÃ¼z kod yok.';
            tr.appendChild(td);
            codesBody.appendChild(tr);
            badgeCount.textContent = '0 kod';
            return;
        }

        codes.forEach((c, idx) => {
            const tr = document.createElement('tr');
            const c1 = document.createElement('td');
            const c2 = document.createElement('td');
            const c3 = document.createElement('td');

            c1.textContent = c.code;
            c1.className = 'code-cell';

            c2.textContent = `SatÄ±r ${idx+1}`;
            c2.style.fontSize = '11px';
            c2.style.color = '#9ca3af';

            c3.textContent = c.line;
            c3.className = 'raw-cell';

            tr.appendChild(c1);
            tr.appendChild(c2);
            tr.appendChild(c3);
            codesBody.appendChild(tr);
        });

        badgeCount.textContent = codes.length + ' kod';
    }

    btnExport.addEventListener('click', () => {
        if (!codes.length) {
            alert('Ã–nce birkaÃ§ kod Ã§Ä±karalÄ±m ğŸ™‚');
            return;
        }

        let csv = 'Code;Line\n';
        codes.forEach(c => {
            const esc = s => '"' + String(s||'').replace(/"/g,'""') + '"';
            csv += esc(c.code) + ';' + esc(c.line) + '\n';
        });

        const bom = '\uFEFF';
        const blob = new Blob([bom + csv], { type:'text/csv;charset=utf-8;' });
        const url  = URL.createObjectURL(blob);
        const a    = document.createElement('a');
        a.href = url;
        a.download = 'parsed_codes.csv';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });
</script>
</body>
</html>
